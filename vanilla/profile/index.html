<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>
        body {
            height: 100vh;
            margin: 0%;
            box-sizing: border-box;
            /* display: flex; */
            /* flex-direction: column; */
            /* justify-content: space-between; */
        }

        header {
            height: 10%;
            background: rgb(34, 206, 106);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0% 2rem;
        }

        #auth {
            /* height: 2rem; */
            /* width: 2rem; */
            /* border-radius: 50%; */
        }

        #homelogo {
            cursor: pointer;
        }

        a {
            all: unset;
        }

        #logout {
            cursor: pointer;
            padding: 1rem;
            background: rgb(226, 226, 226);
            border: none;
            outline: none;
        }

        .one {
            margin-top: 1rem;
            height: 40vh;
            width: 60vw;
            /* background: red; */
            display: flex;
            flex-direction: row;
            justify-content: start;
            align-items: center;
        }

        #avatar {
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #avimg {
            height: 40vh;
            width: 40vh;
            border-radius: 50%;
            background-size: cover;
        }

        #info {
            height: 100%;
            width: 100%;
            /* background: green; */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #auth {
            background: blue;
            position: absolute;
            top: 6vh;
            right: 3vw;
        }

        #loginPanel,
        #registerPanel {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            background: rgb(241, 241, 241);
            border-radius: 1.4rem;
            box-shadow: 2px 2px 2px 1px rgba(0, 0, 0, 0.2);
            padding: 1rem;
        }

        #loginPanel input,
        #registerPanel input,
        b {
            font-size: 1.4rem;
        }


        footer {
            height: 20vh;
            width: 100%;
            background: hsl(145, 74%, 29%);
            /* justify-self: end; */
            /* align-self: flex-end; */
            position: absolute;
            bottom: 0;
        }
    </style>
</head>

<body>
    <!-- hello and welcome -->
    <header>
        <!-- <div id="auth"></div> -->
        <h1 id="homelogo"><a href="home">home (volunteer station)</a></h1>
        <!-- <button id="logout">logout</button> -->
    </header>
    <div class="one">
        <div id="avatar">
            <img id="avimg"></img>
        </div>
        <div id="info">
            <h1 id="userName">userName</h1>
            <h2 id="name">name</h2>
            <h3 id="bio">bio</h3>
            <h5 id="skills">skills;
                <ul>
                    <li>first skill</li>
                    <li>second skill</li>
                </ul>
                available time;
                <ul>
                    <li>???</li>
                </ul>
            </h5>
        </div>

        <!-- auth -->
        <div id="auth">

            <!-- <div id="loginPanel">
                <b>login</b>
                <input id="login-em" type="email" placeholder="email">
                <input id="login-pw" type="text" placeholder="password">
                <button id="login">login</button>
            </div>
            <div id="registerPanel">
                <b>register</b>
                <input id="register-em" type="email" placeholder="email">
                <input id="register-pw" type="text" placeholder="password">
                <button id="user-register">user register</button>
                <button id="org-register">org register</button>
            </div> -->

        </div>


    </div>

    <footer>
        hello from profile ejs
    </footer>


    <script>
        let userName = document.querySelector("#userName")
        let name = document.querySelector("#name")
        let bio = document.querySelector("#bio")
        let ava = document.querySelector("#avimg")

        ///templates; 
        let auth = document.querySelector("#auth")
        let header = document.querySelector("header")

        ////to read cookies; 
        let cookies = document.cookie.replaceAll("%20", " ").replaceAll("%2F", "/").split('; ').reduce((prev,
            current) => {
            const [name, ...value] = current.split('=');
            prev[name] = value.join('=');
            return prev;
        }, {})


        function checkUser() {
            // auth
            if (cookies.cuserName) {
                header.innerHTML = ` <button id="logout">logout</button>`
                ////allow to follow 
                if (cookies.puserName == cookies.cuserName) {

                }

            } else {
                auth.innerHTML = `<div id="loginPanel">
                <b>login</b>
                <input id="login-em" type="email" placeholder="email">
                <input id="login-pw" type="text" placeholder="password">
                <button id="login">login</button>
            </div>
            <div id="registerPanel">
                <b>register</b>
                <input id="register-em" type="email" placeholder="email">
                <input id="register-pw" type="text" placeholder="password">
                <button id="user-register">user register</button>
            </div>`


                let register = document.querySelector("#registerPanel")
                let registerEm = document.querySelector("#register-em")
                let registerPw = document.querySelector("#register-pw")
                let regBtn = document.querySelector("#user-register")

                // register.addEventListener("click", () =>
                // console.log("register clicked"))
                regBtn.addEventListener("click", async () => {
                    console.log(registerEm.value)
                    console.log(registerPw.value)

                    ///check if exist
                    if (registerEm && registerPw) {

                        ///make the object data to be send 
                        let newUser = {
                            em: registerEm.value,
                            pw: registerPw.value
                        }

                        ////send and recieve data
                        let d = await fetch("/regUser", {
                            method: "POST",
                            headers: {
                                "content-type": "application/json"
                            },
                            body: JSON.stringify(newUser)
                        })
                        let pd = await d.json()
                        console.log(pd)
                        ///deploy the received data; may use a function
                        auth.innerHTML = `em: ${pd.em}, pw${pd.pw}`

                        ///empty the values
                        registerEm.value = ""
                        registerPw.value = ""
                    }
                })

            }
        }


        window.onload = () => {

            checkUser()

            ////////////////////

            console.log(cookies)

            userName.textContent = cookies.puserName
            name.textContent = cookies.pname
            bio.textContent = cookies.pbio
            let pimg = cookies.pavatar
            console.log(pimg)

            ava.src = "../home/" + pimg

        }
    </script>

</body>

</html>